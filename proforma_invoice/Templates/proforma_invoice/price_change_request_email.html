{% load quotation_extras %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Proforma Price Change Request</title>
</head>
<body style="font-family: Arial, sans-serif;">

    <h2>ðŸ”” Proforma Price Change Request Submitted</h2>

    <p>
        A new price change request has been submitted for
        <strong>Proforma Invoice #{{ invoice.id }}</strong>.
    </p>

    <p>
        <strong>Requested by:</strong>
        {{ requested_by.get_full_name|default:requested_by.username }}<br>

        <strong>Customer:</strong>
        {{ invoice.customer_name }}<br>

        <strong>Status:</strong> {{ request_obj.status|title }}
    </p>

    <h3>Requested Product Price Changes</h3>

    <table border="1" cellspacing="0" cellpadding="8" width="100%">
        <thead style="background:#f5f5f5;">
            <tr>
                <th align="left">Product</th>
                <th align="right">Old Price (Inc.)</th>
                <th align="right">Requested Price (Inc.)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in invoice.items.all %}
                {% with item_id=item.id|stringformat:"s" %}
                    {% with new_price=requested_product_prices|get_item:item_id %}
                        {% if new_price %}
                        <tr>
                            <td>{{ item.product.name }}</td>
                            <td align="right">â‚¹ {{ item.unit_price|floatformat:2 }}</td>
                            <td align="right">â‚¹ {{ new_price|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                    {% endwith %}
                {% endwith %}
            {% endfor %}
        </tbody>
    </table>

    {% if requested_courier_charge %}
    <h3 style="margin-top:20px;">Requested Courier Change</h3>
    <p>
        <strong>Old Courier Charge:</strong>
        â‚¹ {{ invoice.courier_charge|floatformat:2 }}<br>

        <strong>Requested Courier Charge:</strong>
        â‚¹ {{ requested_courier_charge|floatformat:2 }}
    </p>
    {% endif %}

    <p style="margin-top:30px;">
        <a href="{{ review_url }}" style="
            background: #007bff;
            color: #fff;
            padding: 10px 16px;
            text-decoration: none;
            border-radius: 6px;
            display:inline-block;
        ">
            Review Request
        </a>
    </p>

</body>
</html>
