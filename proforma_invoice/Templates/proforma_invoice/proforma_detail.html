{% load static %}
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Proforma Invoice</title>

<style>
@page { size: A4 portrait; margin: 14mm; }

body{
  font-family: Arial, Helvetica, sans-serif;
  font-size: 12px;
  color:#000;
  margin:0;
}

.Insta-QR{
  width:120px;
  height:120px;
}

.wrapper{ width:100%; }
.invoice-container{ padding:10px 14px; }

/* GLOBAL */
table{ width:100%; border-collapse:collapse; }
td, th{ border:none; padding:6px; vertical-align:top; }

.bold{ font-weight:bold; }
.center{ text-align:center; }
.right{ text-align:right; }

/* HEADER */
.header-top{
  display:flex;
  justify-content:space-between;
}

.company-info{ width:65%; line-height:1.4; margin-right:80px; }
.logo{ width:120px; height:100px; }

hr{
  border:none;
  border-top:2px solid #0b78a8;
  margin:10px 0 14px;
}

.header-title{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  color:#0b78a8;
  margin-bottom:14px;
}

/* INFO GRID */
.info-grid{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:30px;
  margin-bottom:18px;
}
.info-grid b{ display:block; margin-bottom:6px; }

/* ITEM TABLE */
.item-table thead th{
  background:#0b78a8;
  color:#fff;
  font-weight:bold;
  text-align:center;
  font-size:12px;
}

.item-table th.right,
.item-table td.right{ text-align:right; padding-right:12px; font-size:12px; }

.item-table th.center,
.item-table td.center{ text-align:center; font-size:12px; }

.item-table tbody td{ border-bottom:1px solid #999; font-size:12px;}

.item-name{ text-align:left; padding-left:14px; font-size:12px; }

/* TOTALS */
.totals-wrapper{ margin-top:16px; font-size:12px; }

.totals-highlight{
  background:#0b78a8;
  color:#fff;
  font-weight:bold;
  font-size:14px;
}

/* FOOTER */
.footer-text{
  text-align:center;
  font-size:11px;
  margin-top:30px;
}

.qr-box{ width:120px; height:70px;}

/* ================= PRINT-ONLY REFINEMENT ================= */
@media print{

  body{ font-size:11px; }

  .logo{ width:90px; height:60px;}

  .no-print{ display:none; }

  /* tighter rows */
  .item-table thead th,
  .item-table tbody td{
    padding:4px 4px;
    font-size:11px;
  }

  /* make headers feel like 2 rows */
  .item-table thead th:nth-child(5)::after{
    display:block;
    font-size:9px;
    font-weight:normal;
  }

  .item-table thead th:nth-child(6)::after{
    display:block;
    font-size:9px;
    font-weight:normal;
  }

  .item-table thead th:nth-child(7)::after{
    display:block;
    font-size:9px;
    font-weight:normal;
  }

  .item-table thead th:nth-child(8)::after{
    display:block;
    font-size:9px;
    font-weight:normal;
  }

}
</style>
</head>

<body>
<div class="invoice-container">
<div class="wrapper">

<!-- ================= HEADER ================= -->
<div class="header-top">

  <img
    src=" https://oblu-static-media.s3.ap-south-1.amazonaws.com/vector_panda_logo.png"
    class="logo"
    alt="OBLU Logo"
  >

  <div class="company-info">
    <b>OBLU HEALTHCARE LLP</b><br>
    UNIT NO.705-706 PLOT NO.3, P P CITY CENTRE,<br>
    ROAD NO.44, Pitampura, New Delhi – 110034<br>
    Phone : 96504 47099<br>
    Email : sales@obluhc.com<br>
    GSTIN : 07AAIFO0279M1ZU<br>
    PAN : AAIFO0279M<br>
    State : 07-Delhi
  </div>

  <div class="qr-box">
    <img
      src="https://oblu-static-media.s3.ap-south-1.amazonaws.com/insta_qr.png "
      class="Insta-QR"
      alt="Instagram QR"
    >
  </div>

</div>

<hr>

<div class="header-title">Proforma Invoice</div>

<!-- ================= INFO ================= -->
<div class="info-grid">

  <div>
    <b>Order From</b>
    {{ invoice.customer.name }}<br>
    {{ invoice.customer.address }}<br>
    {{ invoice.customer.city }} - {{ invoice.customer.pincode }}<br>
    {{ invoice.customer.state }}<br>
    Contact : {{ invoice.customer.phone }}
  </div>

  <div>
    <b>Ship To</b>
    {{ invoice.customer.name }}<br>
    {{ invoice.customer.address }}<br>
    {{ invoice.customer.city }} - {{ invoice.customer.pincode }}<br>
    {{ invoice.customer.state }}<br>
    Mob : {{ invoice.customer.phone }}
  </div>

  <div>
    <b>Order Details</b>
    Order No. : {{ invoice.id }}<br>
    Date : {{ invoice.date_created|date:"d-m-Y" }}<br>
    Place of Supply : Delhi
  </div>

</div>

<!-- ================= ITEM TABLE ================= -->
<table class="item-table">
<thead>
<tr>
  <th>#</th>
  <th class="item-name">Item name</th>
  <th>HSN</th>
  <th>Qty</th>
  <th class="right">Rate<br>(Inc.)</th>
  <th class="right">Rate<br>(Exc.)</th>
  <th class="right">Taxable <br> Value</th>
  <th class="center">GST%</th>
  <th class="right">Amount</th>
</tr>
  <hr>
</thead>

<tbody>
{% for item in items %}
{% widthratio item.total_price 100 item.taxrate as item_gst %}
{% widthratio item.unit_price 100 item.taxrate as unit_gst %}
{% with item.unit_price|add:unit_gst as rate_incl_tax %}
<tr>
  <td class="center">{{ forloop.counter }}</td>
  <td class="item-name">{{ item.product.name }}</td>
  <td class="center">{{ item.hsn }}</td>
  <td class="center">{{ item.quantity }}</td>
  <td class="right">₹ {{ item.unit_price|floatformat:2 }}</td>
  <td class="right">₹ {{ item.unit_price_excl_tax|floatformat:2 }}</td>
  <td class="right">₹ {{ item.total_price_excl_tax|floatformat:2 }}</td>
  <td class="center">{{ item.taxrate }}%</td>
  <td class="right">₹ {{ item.total_price|floatformat:2 }}</td>

</tr>
{% endwith %}
{% endfor %}
</tbody>
</table>

<!-- ================= TOTALS ================= -->
{% with items.0.taxrate as gst_rate %}
{% widthratio invoice.items_total 100 gst_rate as product_igst %}
{% with invoice.courier_charge|default:0 as courier_charge %}
{% with invoice.courier_gst|default:0 as courier_gst %}
{% with product_igst|add:courier_gst as combined_igst %}
{% with invoice.items_total|add:combined_igst|add:courier_charge as display_total %}

<div class="totals-wrapper">
<table>
<tr>
<!--  <td width="60%" style="font-size:13px;">-->
<!--    <b >Order Amount In Words</b><br>-->
<!--    INR {{  invoice.grand_total_in_words }}-->
<!--  </td>-->

  <td width="40%">
    <table>
      <tr>
        <td class="right bold" style="font-size:13px;">Sub Total</td>
        <td class="right" style="font-size:13px;">₹ {{ invoice.items_total|floatformat:2 }}</td>
      </tr>
      <tr>
        <td class="right bold" style="font-size:13px;">Courier Charges</td>
        <td class="right" style="font-size:13px;">₹ {{ courier_charge|floatformat:2 }}</td>
      </tr>
      <tr>
        <td class="right bold" style="font-size:13px;">IGST @ {{ gst_rate }}%</td>
        <td class="right" style="font-size:13px;">₹ {{ combined_igst|floatformat:2 }}</td>
      </tr>
      <tr class="totals-highlight">
        <td class="right">Total</td>
        <td class="right" style="font-size:13px;">₹ {{ display_total|floatformat:2 }}</td>
      </tr>
    </table>
  </td>
</tr>
</table>
</div>

{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}

<!-- ================= BANK ================= -->
<div style="margin-top:18px;">
  <b>Company's Bank Details</b><br>
  A/c Holder : OBLU HEALTHCARE LLP<br>
  Bank : ICICI BANK (CC)<br>
  A/c No. : 629351001224<br>
  Branch & IFSC : Rajouri Garden & ICIC0006293
</div>

<div style="text-align:right; margin-top:20px;">
  For OBLU HEALTHCARE LLP<br><br>
  <b>Authorized Signatory</b>
</div>

<div class="footer-text">
  This is a computer generated invoice
</div>

<div class="no-print" style="text-align:center;margin-top:14px;">
  <button onclick="window.print()"
    style="padding:8px 16px;background:#333;color:#fff;border:none;cursor:pointer;">
    Print / Save as PDF
  </button>
</div>

</div>
</div>
</body>
</html>