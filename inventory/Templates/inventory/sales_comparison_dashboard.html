{% extends 'inventory/base.html' %}
{% load static %}
{% block content %}

<style>

body {
    background: #3a3a3a !important;   /* Full-page grey */
}

.container.mt-4 {
    background: none !important; /* Remove box background */
    padding: 20px;
}


  .accordion {
    background-color: #1e1e1e;
    color: white;
    cursor: pointer;
    padding: 15px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 17px;
    border-radius: 10px;
    transition: background 0.3s ease;
    margin-top: 10px;
  }

  .active, .accordion:hover {
    background-color: #333;
  }

  .panel {
    padding: 0 18px;
    display: none;
    background-color: #2c2c2c;
    overflow: hidden;
    border-radius: 10px;
    margin-bottom: 10px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  th, td {
    text-align: center;
    padding: 10px;
    color: white;
  }

  thead {
    background: #000;
  }

  tbody tr:nth-child(odd) {
    background: #3a3a3a;
  }

  tbody tr:nth-child(even) {
    background: #4a4a4a;
  }

  .trend-up { color: #00ff87; font-weight: 600; }
  .trend-down { color: #ff5c5c; font-weight: 600; }
  .trend-same { color: #9e9e9e; font-weight: 600; }

  .filter-form {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    background: black;
    padding: 12px 20px;
    border-radius: 12px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    margin-bottom: 25px;
  }


/* ========== INSIGHT CARDS - BASE DESKTOP STYLE ========== */

.insight-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 30px;
}

.insight-row .card {
    flex: 1;
    min-width: 250px;
    padding: 18px;
    border-radius: 14px;

    /* üßä Glass Effect */
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);

    /* Border */
    border: 1px solid rgba(255, 255, 255, 0.12);

    /* Text and smoothness */
    color: white;
    transition: transform 0.25s ease, box-shadow 0.3s ease, border-color 0.25s ease;
}

/* üéØ Hover Glow */
.insight-row .card:hover {
    transform: translateY(-4px);
    box-shadow: 0px 8px 22px rgba(0, 0, 0, 0.4);
    border-color: rgba(0, 255, 150, 0.45);  /* Neon green glow */
}

/* ========== MOBILE RESPONSIVE (PHONES) ========== */
@media (max-width: 400px) {
    .insight-row {
        flex-direction: column;
        gap: 15px;
    }

    .insight-row .card {
        width: 100%;
        min-width: 100%;
        height: 100%;
        margin: 0 auto;

        /* Slightly stronger glass for mobile */
        background: rgba(255, 255, 255, 0.12);
    }
}

/* Optional: spacing under categories */
.category-section {
    margin-bottom: 30px;
}



</style>

<div class="container mt-4">
  <h2 class="text-center mb-3" style="color: white;" >üìàCategory-Wise Sales Comparison </h2>

  <form method="get" class="filter-form">
          <div class="text-center mb-3">
              <input type="text" style="color: black;" id="searchBox" class="form-control" placeholder ="Search category or product..."
         style="max-width: 400px; margin: 0 auto; border-radius: 8px;">
        </div>

    <label>From:</label>
    <input type="date" name="from" value="{{ from_date|date:'Y-m-d' }}">
    <label>To:</label>
    <input type="date" name="to" value="{{ to_date|date:'Y-m-d' }}">
    <button type="submit" class="btn btn-primary">Filter</button>
  </form>


<!--  üîç search box-->
<!--    <div class="text-center mb-3">-->
<!--  <input type="text" id="searchBox" class="form-control" placeholder="Search category or product..."-->
<!--         style="max-width: 400px; margin: 0 auto; border-radius: 8px;">-->
<!--        </div>-->


  {% for category, items in category_data.items %}
    <button class="accordion">{{ category }}</button>
    <div class="panel">
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Previous</th>
            <th>Current</th>
            <th>Œî Diff</th>
            <th>% Change</th>
            <th>Trend</th>
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
            <tr>
              <td>{{ item.name }}</td>
              <td>{{ item.previous }}</td>
              <td>{{ item.current }}</td>
              <td>{{ item.difference }}</td>
              <td>
                {% if item.percent_change != "N/A" %}
                  {{ item.percent_change }}%
                {% else %}N/A{% endif %}
              </td>
              <td>
                {% if item.trend == "up" %}
                  <span class="trend-up">‚ñ≤</span>
                {% elif item.trend == "down" %}
                  <span class="trend-down">‚ñº</span>
                {% else %}
                  <span class="trend-same">‚ñ¨</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% empty %}
    <p class="text-center text-muted">No data available</p>
  {% endfor %}


    <!-- INSIGHTS BELOW -->
<div class="insight-row" style="display:flex; gap:20px; margin-bottom:20px; margin-top: 30px;   ">

    <div class="card" style="background:#1f1f1f; color:white; padding:15px; border-radius:10px; flex:1;">
        <h5>üìä Top 10 Risers</h5>
        <ul class="mb-0">
            {% for item in comparison|dictsortreversed:"difference"|slice:":10" %}
                {% if item.current != item.previous %}
                    <li>‚úÖ <b>{{ item.name }}</b> ‚Äî +{{ item.difference }}</li>
                {% endif %}
            {% empty %}
                <li>No data</li>
            {% endfor %}
        </ul>
    </div>

    <div class="card" style="background:#1f1f1f; color:white; padding:15px; border-radius:10px; flex:1;">
        <h5>üìâ Biggest 10 Drops</h5>
        <ul class="mb-0">
            {% for item in comparison|dictsort:"difference"|slice:":10" %}
                {% if item.current != item.previous %}
                    <li>‚ö†Ô∏è <b>{{ item.name }}</b> ‚Äî {{ item.difference }}</li>
                {% endif %}
            {% empty %}
                <li>No data</li>
            {% endfor %}
        </ul>
    </div>

</div>

</div>

<script>
  // Accordion toggle
  const acc = document.getElementsByClassName("accordion");
  for (let i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
      this.classList.toggle("active");
      const panel = this.nextElementSibling;
      panel.style.display = panel.style.display === "block" ? "none" : "block";
    });
  }

  // üîç Live Search for Category & Product
  const searchBox = document.getElementById("searchBox");
  searchBox.addEventListener("keyup", function() {
    const filter = this.value.toLowerCase();
    const accordions = document.getElementsByClassName("accordion");

    for (let i = 0; i < accordions.length; i++) {
      const acc = accordions[i];
      const categoryName = acc.textContent.toLowerCase();
      const panel = acc.nextElementSibling;
      const rows = panel.getElementsByTagName("tr");

      let matchFound = false;

      // Check if category name matches
      if (categoryName.includes(filter)) {
        matchFound = true;
      } else {
        // Otherwise check products under this category
        for (let j = 0; j < rows.length; j++) {
          const productName = rows[j].getElementsByTagName("td")[0]?.textContent.toLowerCase() || "";
          if (productName.includes(filter)) {
            matchFound = true;
            break;
          }
        }
      }

      // Show or hide category + panel
      if (matchFound) {
        acc.style.display = "";
        panel.style.display = acc.classList.contains("active") ? "block" : "none";
      } else {
        acc.style.display = "none";
        panel.style.display = "none";
      }
    }
  });
</script>

{% endblock %}