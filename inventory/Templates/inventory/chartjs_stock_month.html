<!-- templates/inventory/chartjs_stock.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸ“Š Stock Charts Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
            color: #e0e0e0;
            padding: 2rem;
            margin: 0;
        }

        h1 {
            text-align: center;
            font-size: 2.4rem;
            margin-bottom: 2rem;
            color: #ffffff;
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            padding-left: 0.6rem;
            border-left: 5px solid #00ffcc;
            color: #ffffff;
        }

        .chart-container {
            background-color: rgba(255, 255, 255, 0.04);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 0 10px rgba(0,255,204,0.15);
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        form {
            text-align: center;
            margin-bottom: 2rem;
        }

        label {
            margin: 0 0.5rem;
        }

        input, button {
            margin: 0 0.5rem;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            border: none;
            outline: none;
        }

        button {
            background-color: #00ffcc;
            color: #000;
            font-weight: 600;
            cursor: pointer;
        }

        button:hover {
            background-color: #00e6b8;
        }
    </style>
</head>
<body>
    <h1>ðŸ“ˆ Stock Analytics Dashboard</h1>

    <!-- Month Range Filter -->
    <form id="monthFilterForm">
        <label for="startMonth">Start Month:</label>
        <input type="month" id="startMonth">

        <label for="endMonth">End Month:</label>
        <input type="month" id="endMonth">

        <button type="button" onclick="filterByMonth()">Apply Filter</button>
        <button type="button" onclick="resetFilter()">Reset</button>
    </form>

    <div class="chart-container">
        <h2>ðŸ“¦ Inward vs Outward Quantity</h2>
        <canvas id="inwardOutwardQtyChart"></canvas>
    </div>

    <div class="chart-container">
        <h2>ðŸ“¦ Inward vs Outward Value</h2>
        <canvas id="inwardOutwardValueChart"></canvas>
    </div>
    <div class="chart-container">
        <h2>ðŸ“Š Closing Stock Quantity Trend</h2>
        <canvas id="closingQtyChart"></canvas>
    </div>
    <div class="chart-container">
        <h2>ðŸ’° Closing Stock Value Trend</h2>
        <canvas id="closingValueChart"></canvas>
    </div>

    <div class="chart-container">
    <h2>ðŸ“¦ Inward vs Outward Quantity (Bar)</h2>
    <canvas id="inwardOutwardQtyBarChart"></canvas>
</div>

<div class="chart-container">
    <h2>ðŸ“¦ Inward vs Outward Value (Bar)</h2>
    <canvas id="inwardOutwardValueBarChart"></canvas>
</div>

<div class="chart-container">
    <h2>ðŸ“Š Closing Stock Quantity (Bar)</h2>
    <canvas id="closingQtyBarChart"></canvas>
</div>

<div class="chart-container">
    <h2>ðŸ’° Closing Stock Value (Bar)</h2>
    <canvas id="closingValueBarChart"></canvas>
</div>


    <script>
        const rawData = JSON.parse('{{ chart_data|escapejs }}');
        let filteredData = {...rawData};
        let charts = [];

        function filterByMonth() {
            const start = document.getElementById("startMonth").value;
            const end = document.getElementById("endMonth").value;

            if (!start && !end) {
                filteredData = {...rawData};
            } else {
                filteredData = {
                    labels: [],
                    inwards_qty: [],
                    outwards_qty: [],
                    inwards_value: [],
                    outwards_value: [],
                    closing_qty: [],
                    closing_value: []
                };

                rawData.labels.forEach((label, idx) => {
                    if ((!start || label >= start) && (!end || label <= end)) {
                        filteredData.labels.push(label);
                        filteredData.inwards_qty.push(rawData.inwards_qty[idx]);
                        filteredData.outwards_qty.push(rawData.outwards_qty[idx]);
                        filteredData.inwards_value.push(rawData.inwards_value[idx]);
                        filteredData.outwards_value.push(rawData.outwards_value[idx]);
                        filteredData.closing_qty.push(rawData.closing_qty[idx]);
                        filteredData.closing_value.push(rawData.closing_value[idx]);
                    }
                });
            }

            updateCharts();
        }

        function resetFilter() {
            document.getElementById("startMonth").value = "";
            document.getElementById("endMonth").value = "";
            filteredData = {...rawData};
            updateCharts();
        }

        function renderCharts() {
            charts.forEach(chart => chart.destroy());
            charts = [];

            charts.push(new Chart(document.getElementById("inwardOutwardQtyChart"), {
                type: 'line',
                data: {
                    labels: filteredData.labels,
                    datasets: [
                        { label: 'Inwards', data: filteredData.inwards_qty, borderColor: '#00bfff', fill: false, tension: 0.3, pointRadius: 4 },
                        { label: 'Outwards', data: filteredData.outwards_qty, borderColor: '#ff4d4d', fill: false, tension: 0.3, pointRadius: 4 }
                    ]
                },
                options: chartOptions
            }));

            charts.push(new Chart(document.getElementById("inwardOutwardValueChart"), {
                type: 'line',
                data: {
                    labels: filteredData.labels,
                    datasets: [
                        { label: 'Inwards', data: filteredData.inwards_value, borderColor: '#00bfff', fill: false, tension: 0.3, pointRadius: 4 },
                        { label: 'Outwards', data: filteredData.outwards_value, borderColor: '#ff4d4d', fill: false, tension: 0.3, pointRadius: 4 }
                    ]
                },
                options: chartOptions
            }));

            charts.push(new Chart(document.getElementById("closingQtyChart"), {
                type: 'line',
                data: {
                    labels: filteredData.labels,
                    datasets: [{ label: 'Closing Quantity', data: filteredData.closing_qty, borderColor: '#ba68c8', fill: false, tension: 0.3, pointRadius: 4 }]
                },
                options: chartOptions
            }));

            charts.push(new Chart(document.getElementById("closingValueChart"), {
                type: 'line',
                data: {
                    labels: filteredData.labels,
                    datasets: [{ label: 'Closing Value (INR)', data: filteredData.closing_value, borderColor: '#00e676', fill: false, tension: 0.3, pointRadius: 4 }]
                },
                options: chartOptions
            }));
        }

        charts.push(new Chart(document.getElementById("inwardOutwardQtyBarChart"), {
        type: 'bar',
        data: {
            labels: filteredData.labels,
            datasets: [
                { label: 'Inwards', data: filteredData.inwards_qty, backgroundColor: '#00bfff' },
                { label: 'Outwards', data: filteredData.outwards_qty, backgroundColor: '#ff4d4d' }
            ]
        },
        options: {
            ...chartOptions,
            scales: {
                x: { stacked: true, ticks: { color: '#cccccc' }, grid: { color: '#444' } },
                y: { stacked: true, ticks: { color: '#cccccc' }, grid: { color: '#444' } }
            }
        }
    }));

        function updateCharts() {
            renderCharts();
        }

        const chartOptions = {
            responsive: true,
            plugins: {
                legend: { labels: { color: "#e0e0e0" } },
                title: { display: false }
            },
            scales: {
                x: { ticks: { color: '#cccccc' }, grid: { color: '#444' } },
                y: { ticks: { color: '#cccccc' }, grid: { color: '#444' } }
            }
        };

        // Initial render
        renderCharts();
    </script>


</body>
</html>
